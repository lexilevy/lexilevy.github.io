<!DOCTYPE html><html><head><meta charset="UTF-8"><title>test for app-scroll-effects-behavior</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="../../node_modules/@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script><script src="../../node_modules/wct-browser-legacy/browser.js"></script><style>body{margin:0;padding:0;height:1000vh;}x-container{position:fixed;top:0;left:0;right:0;height:200px;}</style></head><body><test-fixture id="testHeader"><template><x-container></x-container></template></test-fixture><script>define(["./x-container.js","../../helpers/helpers.js"],function(_xContainer,_helpers){"use strict";function scrollTestHelper(scroller,tests){function scrollEventHandler(){var nextTest=tests.shift();if(nextTest){nextTest.callback();if(0<tests.length)triggerScrollEvent()}}function triggerScrollEvent(){var scrollTop=scroller===document.documentElement?window.pageYOffset:scroller.scrollTop;if(tests[0].y===scrollTop){scrollEventHandler()}else{if(scroller===document.documentElement)window.scrollTo(0,tests[0].y);else scroller.scrollTop=tests[0].y}}if(0<tests.length){var scrollTarget=scroller===document.documentElement?window:scroller;scrollTarget.addEventListener("scroll",scrollEventHandler);triggerScrollEvent()}}suite("basic features",function(){var container,testEffect;suiteSetup(function(){testEffect={setUp:sinon.spy(),tearDown:sinon.spy(),run:sinon.spy()};(0,_helpers.registerEffect)("test-effect",testEffect)});setup(function(){container=fixture("testHeader");testEffect.setUp.reset();testEffect.tearDown.reset();testEffect.run.reset()});test("simple effect",function(done){container.effects="test-effect";flush(function(){scrollTestHelper(container.scrollTarget,[{y:0,callback:function(){assert.isTrue(testEffect.setUp.called);assert.deepEqual(testEffect.run.lastCall.args,[0,0])}},{y:.5*container.offsetHeight,callback:function(){assert.deepEqual(testEffect.run.lastCall.args,[.5,.5*container.offsetHeight])}},{y:container.offsetHeight,callback:function(){assert.deepEqual(testEffect.run.lastCall.args,[1,container.offsetHeight])}},{y:2*container.offsetHeight,callback:function(){assert.deepEqual(testEffect.run.lastCall.args,[2,2*container.offsetHeight])}},{y:3*container.offsetHeight,callback:function(){assert.deepEqual(testEffect.run.lastCall.args,[3,3*container.offsetHeight]);container.effects="";assert.isTrue(testEffect.tearDown.called);done()}}])})});test("effect with config",function(done){var testEffectConfig={startsAt:.5,endsAt:1};container.effects="test-effect";container.effectsConfig={"test-effect":testEffectConfig};flush(function(){scrollTestHelper(container.scrollTarget,[{y:0,callback:function(){assert.isTrue(testEffect.setUp.called);assert.deepEqual(testEffect.setUp.lastCall.args,[testEffectConfig]);assert.deepEqual(testEffect.run.lastCall.args,[0,0])}},{y:.25*container.offsetHeight,callback:function(){assert.deepEqual(testEffect.run.lastCall.args,[0,.25*container.offsetHeight])}},{y:.5*container.offsetHeight,callback:function(){assert.deepEqual(testEffect.run.lastCall.args,[0,.5*container.offsetHeight])}},{y:.75*container.offsetHeight,callback:function(){assert.deepEqual(testEffect.run.lastCall.args,[.5,.75*container.offsetHeight])}},{y:container.offsetHeight,callback:function(){assert.deepEqual(testEffect.run.lastCall.args,[1,container.offsetHeight]);container.effects="";assert.isTrue(testEffect.tearDown.called);done()}}])})});test("threshold and threshold-triggered",function(done){flush(function(){assert.isUndefined(container.thresholdTriggered);assert.equal(container.threshold,0);container.threshold=100;scrollTestHelper(container.scrollTarget,[{y:0,callback:function(){assert.isFalse(container.thresholdTriggered)}},{y:100,callback:function(){assert.isTrue(container.thresholdTriggered)}},{y:50,callback:function(){assert.isFalse(container.thresholdTriggered);done()}}])})});test("reset threshold-triggered on attached (#570)",function(done){flush(function(){var parent=container.parentElement;assert.isUndefined(container.thresholdTriggered);assert.equal(container.threshold,0);container.threshold=100;scrollTestHelper(container.scrollTarget,[{y:100,callback:function(){assert.isTrue(container.thresholdTriggered);parent.removeChild(container);assert.isTrue(container.thresholdTriggered)}},{y:0,callback:function(){assert.isTrue(container.thresholdTriggered);parent.appendChild(container);assert.isFalse(container.thresholdTriggered);done()}}])})})})});</script></body></html>