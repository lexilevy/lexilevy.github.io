define(["exports","../lit-html.js"],function(_exports,_litHtml){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.repeat=repeat;const keyMapCache=new WeakMap;function cleanMap(part,key,map){if(!part.startNode.parentNode){map.delete(key)}}function repeat(items,keyFnOrTemplate,template){let keyFn;if(2===arguments.length){template=keyFnOrTemplate}else if(3===arguments.length){keyFn=keyFnOrTemplate}return(0,_litHtml.directive)(part=>{let keyMap=keyMapCache.get(part);if(keyMap===void 0){keyMap=new Map;keyMapCache.set(part,keyMap)}const container=part.startNode.parentNode;let index=-1,currentMarker=part.startNode.nextSibling;for(const item of items){let result,key;try{++index;result=template(item,index);key=keyFn?keyFn(item):index}catch(e){console.error(e);continue}let itemPart=keyMap.get(key);if(itemPart===void 0){const marker=document.createTextNode(""),endNode=document.createTextNode("");container.insertBefore(marker,currentMarker);container.insertBefore(endNode,currentMarker);itemPart=new _litHtml.NodePart(part.instance,marker,endNode);if(key!==void 0){keyMap.set(key,itemPart)}}else if(currentMarker!==itemPart.startNode){const end=itemPart.endNode.nextSibling;if(currentMarker!==end){(0,_litHtml.reparentNodes)(container,itemPart.startNode,end,currentMarker)}}else{currentMarker=itemPart.endNode.nextSibling}itemPart.setValue(result)}if(currentMarker!==part.endNode){(0,_litHtml.removeNodes)(container,currentMarker,part.endNode);keyMap.forEach(cleanMap)}})}});